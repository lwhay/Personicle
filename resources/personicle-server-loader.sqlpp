DROP DATAVERSE PersonicleServer IF EXISTS;

CREATE DATAVERSE PersonicleServer;

USE PersonicleServer;

CREATE TYPE AddressType AS OPEN {
  category: string?,
  address: string,
  city: string,
  state: string,
  postalCode: string
};
CREATE TYPE PhoneDetailType AS OPEN {
  category: string?,
  phone: string
};
CREATE TYPE EmailDetailType AS OPEN {
  category: string?,
  email: string
};
CREATE TYPE UserType AS OPEN {
  userId: string,
  userName: string?,
  dateOfBirth: date?,
  addresses: [AddressType]?,
  phones: [PhoneDetailType]?,
  emails: [EmailDetailType]?
};

CREATE DATASET users(UserType) PRIMARY KEY userId;

USE PersonicleServer;

DROP DATASET FoodLog IF EXISTS;

DROP TYPE FoodLogType IF EXISTS;

CREATE TYPE FoodLogType AS OPEN {
  logId: uuid,
  userId: string,
  timestamp: bigint,
  userName: string?,
  foodname: string,
  weight: double,
  total_calories: double,
  latitude: double,
  longitude: double,
  preference_star: int,
  comments: string
};

CREATE DATASET FoodLog(FoodLogType) PRIMARY KEY logId AUTOGENERATED;

use PersonicleServer;
create index FoodUserIdIdx on FoodLog(userId) type btree;
create index UserNameIdx on users(userName) type btree;

DROP DATASET Food IF EXISTS;

DROP TYPE FoodType IF EXISTS;

CREATE TYPE FoodType AS OPEN {
  foodname: string, --primary key
  calories: double,
  carbohydrate: double,
  fat: double,
  protein: double
};

CREATE DATASET Food(FoodType) PRIMARY KEY foodname;

use PersonicleServer;
load dataset users using localfs
(("path"="127.0.0.1:///media/nvme/Work/Personicle/pseudo_users.adm"),("format"="adm"));

use PersonicleServer;
load dataset Food using localfs
(("path"="127.0.0.1:///media/nvme/Work/Personicle/food.adm"),("format"="adm"));

use PersonicleServer;
load dataset FoodLog using localfs
(("path"="127.0.0.1:///media/nvme/Work/Personicle/foodlog.adm"),("format"="adm"));

use PersonicleServer;
create index FoodNameLogIdx on FoodLog(foodname) type btree;
